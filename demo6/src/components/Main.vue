<template>

  <el-container>
    <el-header>header</el-header>
    <el-container>
      <el-aside>aside</el-aside>
      <el-main>
        <el-container>
          <el-main>

            <table style="line-height: 50px;"><tr><td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-1-10">
              &nbsp;
            </td> <td class="qp q-1-11">
              &nbsp;
            </td> <td class="qp q-1-12">
              &nbsp;
            </td> <td class="qp q-1-13">
              &nbsp;
            </td> <td class="qp q-2-1">
              &nbsp;
            </td> <td class="qp q-2-2">
              &nbsp;
            </td> <td class="qp q-2-3"><i class="el-icon-setting"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td></tr> <tr><td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-1-9">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q2 h-2-1">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-2-4">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td></tr> <tr><td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-1-8">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q2 h-2-2">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q-2-5">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td></tr> <tr><td class="qp q-1-3"><i class="el-icon-setting"></i></td> <td class="qp q-1-4">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-1-7"><i class="el-icon-right"></i></td> <td><i class="el-icon-arrow-right"></i></td> <td class="qp q2 h-2-3">
              &nbsp;
            </td> <td><i class="el-icon-arrow-right"></i></td> <td class="qp q-2-6">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-2-9">
              &nbsp;
            </td> <td class="qp q-2-10">
              &nbsp;
            </td></tr> <tr><td class="qp q-1-2">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q-1-5">
              &nbsp;
            </td> <td class="qp q-1-6">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q2 h-2-4">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-2-7"><i class="el-icon-bottom"></i></td> <td class="qp q-2-8">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q-2-11">
              &nbsp;
            </td></tr> <tr><td class="qp q-1-1">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td><i class="el-icon-arrow-up"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q2 h-2-5">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td><i class="el-icon-arrow-down"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-2-12">
              &nbsp;
            </td></tr> <tr><td class="qp q-4-13">
              &nbsp;
            </td> <td class="qp q1 h-1-1">
              &nbsp;
            </td> <td class="qp q1 h-1-2">
              &nbsp;
            </td> <td class="qp q1 h-1-3">
              &nbsp;
            </td> <td class="qp q1 h-1-4">
              &nbsp;
            </td> <td class="qp q1 h-1-5">
              &nbsp;
            </td> <td class="IN"><i class="el-icon-star-off"></i></td> <td class="qp q3 h-3-5">
              &nbsp;
            </td> <td class="qp q3 h-3-4">
              &nbsp;
            </td> <td class="qp q3 h-3-3">
              &nbsp;
            </td> <td class="qp q3 h-3-2">
              &nbsp;
            </td> <td class="qp q3 h-3-1">
              &nbsp;
            </td> <td class="qp q-2-13">
              &nbsp;
            </td></tr> <tr><td class="qp q-4-12">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td><i class="el-icon-arrow-up"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q4 h-4-5">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td><i class="el-icon-arrow-down"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-3-1">
              &nbsp;
            </td></tr> <tr><td class="qp q-4-11">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q-4-8">
              &nbsp;
            </td> <td class="qp q-4-7"><i class="el-icon-top"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q4 h-4-4">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-3-6">
              &nbsp;
            </td> <td class="qp q-3-5">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q-3-2">
              &nbsp;
            </td></tr> <tr><td class="qp q-4-10">
              &nbsp;
            </td> <td class="qp q-4-9">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-4-6">
              &nbsp;
            </td> <td><i class="el-icon-arrow-left"></i></td> <td class="qp q4 h-4-3">
              &nbsp;
            </td> <td><i class="el-icon-arrow-left"></i></td> <td class="qp q-3-7"><i class="el-icon-back"></i></td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-3-4">
              &nbsp;
            </td> <td class="qp q-3-3"><i class="el-icon-setting"></i></td></tr> <tr><td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-4-5">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q4 h-4-2">
              &nbsp;
            </td> <td>&nbsp;</td> <td class="qp q-3-8">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td></tr> <tr><td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-4-4">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q4 h-4-1">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-3-9">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td></tr> <tr><td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td> <td class="qp q-4-3"><i class="el-icon-setting"></i></td> <td class="qp q-4-2">
              &nbsp;
            </td> <td class="qp q-4-1">
              &nbsp;
            </td> <td class="qp q-3-13">
              &nbsp;
            </td> <td class="qp q-3-12">
              &nbsp;
            </td> <td class="qp q-3-11">
              &nbsp;
            </td> <td class="qp q-3-10">
              &nbsp;
            </td> <td>&nbsp;</td> <td>&nbsp;</td> <td>&nbsp;</td></tr></table>
          </el-main>
          <el-footer>

            <el-button @click.native="login"  >连接</el-button>
            <template v-for="play in playList" >

              <el-button @click.native="select(play.code)" v-if="play.use==0" >{{play.name}}</el-button>

            </template>
            <el-button @click.native="start"  >准备</el-button>
            <el-button @click.native="yao"  >摇色子</el-button>
            观战
          </el-footer>
        </el-container>
      </el-main>
    </el-container>
  </el-container>

</template>

<style scope>
  td{
    width: 50px; height: 50px;
  }
  .qp{
    border: 2px solid black;
  }
  .q1,.q-4-13,.q-4-9,.q-4-5,.q-4-1,.q-3-10,.q-3-6,.q-3-2,.q-2-11,.q-2-7,.q-2-3,.q-1-12,.q-1-8,.q-1-4{
    border:2px solid  #F56C6C;
  }
  .q2,.q-1-13,.q-1-9,.q-1-5,.q-1-1,.q-4-10,.q-4-6,.q-4-2,.q-3-11,.q-3-7,.q-3-3,.q-2-12,.q-2-8,.q-2-4{
    border:2px solid   #E6A23C;
  }
  .q3,.q-2-13,.q-2-9,.q-2-5,.q-2-1,.q-1-10,.q-1-6,.q-1-2,.q-4-11,.q-4-7,.q-4-3,.q-3-12,.q-3-8,.q-3-4{
    border:2px solid  #409EFF;
  }
 .q4,.q-3-13,.q-3-9,.q-3-5,.q-3-1,.q-2-10,.q-2-6,.q-2-2,.q-1-11,.q-1-7,.q-1-3,.q-4-12,.q-4-8,.q-4-4{
    border:2px solid   #67C23A;
  }
</style>
<script>
  import  $ from 'jquery'
  export default {
    name: 'Main',
    socket:null,
    playList:[],
    status:0,
    data() {
      return {
        msg: 'Welcome to Your Vue.js App'
      }
    },created () {

    },mounted () {
      // 初始化
      this.init()
    },
    methods: {

      start:function(){
        this.send({type:"start"});
      },
      yao:function(){
        this.send({type:"yao"});
      },
      selectBtn:function(play){
        this.send({type:"selectBtn",playcode:play});
      },
      select:function(play){
        this.send({type:"select",playcode:play});
      },
      login:function(){

        if(   this.socket.readyState==3){
          this.init()
        }else{
          this.send({type:"insert"});
        }

      },
      init: function () {
        if(typeof(WebSocket) === "undefined"){
          alert("您的浏览器不支持socket")
        }else{
          // 实例化socket
          this.socket = new WebSocket("ws://127.0.0.1:3001");
          // 监听socket连接
          this.socket.onopen = this.open
          // 监听socket错误信息
          this.socket.onerror = this.error
          // 监听socket消息
          this.socket.onmessage = this.getMessage
         // this.send({type:"insert"});
        }
      },
      open: function () {
        console.log("socket连接成功")
      },
      error: function () {
        console.log("连接错误")
      },
      getMessage: function (msg) {
        console.log(msg.data)
        var   data = JSON.parse(msg.data);

        if(data.type=='insert'){
          this.playList=data.playList;
          this.$forceUpdate()
        }
        if(data.select=='select'){
            for(var i in  this.playList){
               var p=this.playList[i];
               if(p.code=data.code){
                 p.use=1;
               }
            }
        }
        if(data.type=='start'){
            for(var i in this.playList){
              var play=this.playList[i];
              for(var j in play.qizis){
                var q=play.qizis[j];
                $(".q-"+q.h+"-"+q.w).append(this.getBtn(q))
              }
            }
        }

        if(data.type=='yao'){
            $(".IN").html(data.num);
        }

        if(data.type=='move'){
          var q=data.btn;
          $("."+q.code).remove();
          $(".q-"+q.h+"-"+q.w).append(this.getBtn(q))
        }

      },getBtn(q){
        var self=this;
        var btn=$("<button class='"+q.code+"'>"+q.name+"</button>");
        btn.click(function () {
          var myclas=$(this).attr("class");
          self.selectBtn(myclas);
        })
        return btn;
      },
      send: function (params) {
        var   str=JSON.stringify(params);
        this.socket.send(str)
      },
      close: function () {
        console.log("socket已经关闭")
      }
    },
    destroyed () {
      // 销毁监听
      this.socket.onclose = this.close
    }
  }
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
